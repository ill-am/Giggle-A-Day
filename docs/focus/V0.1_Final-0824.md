# V0.1 Final Actionables — 2025-08-24

Task receipt and plan

- What I'm doing next: extract actionables from `V0.1_Finalized.md` and `V0.1_Current-status+pending_0824.md`, create a single verified checklist document with clear priorities, estimates, and verification instructions, then commit and push it to the feature branch.

How this document is used

- Work is performed in strict sequence top→down. Each action item must be implemented, then marked as "[x] Verified" in this document with a one-line verification note and a reference (commit hash / PR / test run) before the team begins the next item.

Checklist (actionables to reach finalized V0.1)

1. Image Generation Pipeline — Gemini integration (Priority: 1) — Estimate: 4h

   - [ ] Add production Gemini image generation implementation behind env guard
     - Notes: implement `generateWithGemini(payload)` in `server/imageGenerator.js` and wire where `generateWithGemini` placeholder exists.
   - [ ] Add image quality validation (DPI, dimensions, format)
   - [ ] Add rasterization and format conversion tests (SVG→PNG via `sharp` when available)
         Verification: update this item with `[x] Verified` + one-line note and commit/PR hash.

2. Background Job Queue — SQLite-backed jobs (Priority: 2) — Estimate: 3h

   - [ ] Add `jobs` table schema to DB initialization (fields: id, payload JSON, state, progress, file_path, error, created_at, updated_at, locked_by, locked_at)
   - [ ] Implement `server/jobs.js` helpers: `enqueueJob`, `getJob`, `claimNextJob`, `updateJobProgress`, `finalizeJob`, `failJob`
   - [ ] Update `POST /api/export/job` to call `enqueueJob(payload)` and return jobId immediately (keep in-memory fallback path)
   - [ ] Add `server/worker-sqlite.js` — polling worker that claims jobs, calls `processExportJob(job)`, writes to `server/samples/exports/` using atomic temp-write + rename, updates progress
   - [ ] Add recovery pass: return long-processing `processing` jobs to `queued` after X minutes
         Verification: mark `[x] Verified` + note including a smoke export run and sample job record.

3. PDF Quality & Export Robustness (Priority: 3) — Estimate: 3h

   - [ ] Add basic quality checks: DPI heuristic, page size, and required font markers
   - [ ] Harden PDF generation error handling (timeouts, Puppeteer launch errors, write failures)
   - [ ] Add non-fatal PDF validation step in `server/pdfGenerator.js` with warnings for CI
         Verification: `[x] Verified` with test artifact path and brief test summary.

4. E2E Testing & Error Scenarios (Priority: 4) — Estimate: 4h

   - [ ] Full E2E test for summer poems flow (prompt → preview → export) using existing smoke harness or Puppeteer-core
   - [ ] Add tests for AI service failure modes (simulate Gemini errors / timeouts)
   - [ ] Add tests for image generation failures and PDF export failures
         Verification: `[x] Verified` with test run output (CI job / local artifact) and reference.

5. UI Polish & UX (Priority: 5) — Estimate: 2h

   - [ ] Add summer-specific prompt guidance in prompt UI
   - [ ] Improve export progress UI (percent / stage messages) in `client` components
   - [ ] Improve error messages and retry affordances on the UI
         Verification: `[x] Verified` with screenshot or commit note.

6. Documentation & Developer Experience (Priority: 6) — Estimate: 2h

   - [ ] Complete API docs for `/api/export/book`, `/api/export/job`, `/api/preview` including request/response schemas and examples
   - [ ] Update `.devcontainer/README.md` and `README.md` with steps to run the worker and how to provide Gemini credentials
   - [ ] Add a short "How to verify V0.1" section describing smoke commands and artifact locations
         Verification: `[x] Verified` with link to updated docs and commit/PR.

7. CI / Smoke Automation (Priority: 7) — Estimate: 2h
   - [ ] Add/adjust CI job to run in-process export verification and upload artifacts (if not present or flaky)
   - [ ] Ensure `server/scripts/smoke-export.sh` is run and validated in CI as a gate (verify PDF magic bytes)
         Verification: `[x] Verified` with CI run link or logs.

Cross-cutting items

- [ ] Add monitoring/logging for worker (progress logs, failures) — small logrotate or retention note (0.5h)
- [ ] Ensure sample output artifacts are written to `server/test-artifacts/` or `server/samples/exports/` with unique temp names (0.5h)

Total remaining estimate: ~15–18 hours (includes small cross-cutting tasks and buffer)

Execution rules

- Each item must be checked off here before the next item begins. Checking off requires:
  1. Code committed to feature branch (or PR merged into this branch) with a clear commit message
  2. A one-line verification note in this document referencing commit/PR hash and brief outcome
  3. Where applicable, an automated test or smoke run that produced an artifact (attach artifact path)

How to check off an item

- Edit this file, change the checkbox from `[ ]` to `[x]`, add a one-line verification note under that item with commit hash or brief test artifact info, commit the change, and push.

Immediate next step

- Start with "Image Generation Pipeline — Gemini integration" (item 1). Implement `generateWithGemini` behind an env var and add a minimal test that exercises the new code path; then update this document to `[x] Verified` with the commit hash.

---

Notes

- Estimates assume a single engineer working with current repo knowledge and local devcontainer available. Parallelization can reduce wall-clock time.
- If Gemini access is not available, implement a small toggle that uses the offline SVG stub generator but still validates the code path; record that as a temporary verification step until real API keys are provided.
