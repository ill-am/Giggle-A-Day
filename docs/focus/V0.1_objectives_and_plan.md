## V0.1 — Objectives and Implementation Plan
V0.1_objectives_and_plan -- Tue, 2nd Sep 2025

Purpose

- Capture the agreed V0.1 product objective and clear acceptance criteria for the frontend-driven export/demo flows.
- Surface a prioritized, non-technical checklist of pending implementation and automated validation tasks so the team can implement them later.

Background / Goal

- Demo goal (from README): produce an A4 eBook of public-domain summer poems — one poem per page with a poem-describing decorative background image.
- The frontend should drive the entire flow: compose content, preview, and export a high-quality A4 PDF without manual CLI interaction.

Acceptance criteria (how we know V0.1 is done)

1. Frontend UI: a user can load or create a poem (title + body + optional background) and click Export → browser downloads a PDF named `AetherPress-Export-<timestamp>.pdf`.
2. PDF output: contains one poem per A4 page, decorative backgrounds applied, readable typography, and page breaks between poems.
3. Preview: the app provides an in-browser preview that reflects the exported PDF (WYSIWYG / close match).
4. Security/Dev UX: when running in Codespaces, the Vite dev proxy injects the dev-only header so the browser can call the backend without manual header fiddling; public ports may be opened once but endpoints are protected by `DEV_AUTH_TOKEN`.
5. Automated validation: a reproducible smoke/e2e test exists that exercises preview→export and verifies the backend returns a PDF and (optionally) saves the artifact.

High-level constraints

- No secrets committed to git. Use Codespaces secrets or ignored `.env` for local dev tokens.
- Exports rely on Puppeteer/Chromium being available to the server; client should show clear diagnostics if service is not ready.

Prioritized implementation backlog (non-sequential)

Must-have (short-term)

- A. One-click demo loader: a UI button that populates the prompt/editor with a valid V0.1 demo payload. (Effort: very small)
- B. Export from UI: ensure `/export` path returns a downloadable PDF and the client triggers a download blob. (Effort: small)
- C. Client error surface: visible toasts or an error panel that shows API failures (401/502/422) instead of relying on DevTools. (Effort: small)
- D. Treat 401 as fatal in retry logic so auth failures surface immediately. (Effort: tiny)

Nice-to-have (medium-term)

- E. In‑UI smoke test: a button that runs a preview→export sequence client-side and reports pass/fail (saves a small diagnostic on failure). (Effort: small–medium)
- F. Diagnostics page: shows `/health`, Puppeteer readiness, recent export job status, and last error. (Effort: small)
- G. Playwright/Puppeteer e2e script: headless test that starts the app, runs the UI flow, and stores artifacts (PDF + screenshots). (Effort: medium)

Long-term / CI (high value)

- H. CI smoke test: GitHub Action that runs headless export on push/PR and uploads artifacts for failures. (Effort: medium)
- I. Observability: Sentry or lightweight logging to capture client exceptions and network failures. (Effort: small)

Automated validation plan (minimal viable)

1. Add a Playwright or Puppeteer script that:
   - Loads the frontend (Vite URL) or static preview that proxies to server
   - Clicks the demo loader
   - Clicks Export
   - Verifies the server responds with `Content-Type: application/pdf` and saves the response as an artifact (`tmp-smoke-export.pdf`).
2. Provide an npm script `npm run smoke:e2e` that runs the test locally and returns non-zero on failure.
3. Later wire the same script into a GitHub Action for PR validation.

Developer runbook (how to run locally — for later execution)

```bash
# Start backend (inside Codespace so dev secrets are available)
cd server
# ensure DEV_AUTH_TOKEN is set (Codespaces secret or server/.env)
node index.js

# Start frontend (Vite)
cd ../client
npm run dev

# Run smoke test locally (once Playwright/Puppeteer script added)
cd ../client
npm run smoke:e2e
```

Deliverables (by completion)

- Frontend UI: demo loader, preview, export button, in-place error toasts.
- Tests: Playwright/Puppeteer e2e script and `npm run smoke:e2e` script.
- CI: optional GitHub Action to run smoke test on push/PR.
- Docs: this planning file plus a short `docs/DEMO_README.md` that explains the single-click demo and smoke test usage.

Next actions (pick one)

- 1. Implement the frontend UI helpers first (A, B, C, D) so you can test manually with one click.
- 2. Add the in‑UI smoke test (E) and Playwright script (G) so you can run a single button/command to validate everything.
- 3. Implement CI smoke on the main branch (H) after 1–2 are in place.

Notes

- This document intentionally separates product acceptance (what the demo should produce) from engineering tasks (how to get there). Pick which item you want implemented next and I will create the necessary code, tests, and small README entries.

Status: pending implementation — this document captures the agreed goals and the prioritized plan.

---

## Tomorrow sprint (one-day push)

Objective

- Complete the minimal V0.1 prototype so the frontend can produce a demonstrable A4 PDF export from the UI and a reproducible smoke/e2e validation exists.

Top priorities (must complete today)

1. Implement A (One-click demo loader) — 30–60 minutes

   - Deliverable: UI button that populates the editor with V0.1 demo content.
   - Acceptance: Demo content loads with one click and fields are valid for export.

2. Implement B (Export from UI) — 60–120 minutes

   - Deliverable: Export button triggers POST /export and initiates a browser download of the returned PDF.
   - Acceptance: Downloaded PDF opens and contains the demo content formatted as A4 pages.

3. Implement C & D (Toasts + stop retry-on-401) — 30–60 minutes
   - Deliverable: Visible error toasts for API failures; `fetchWithRetry` treats 401 as fatal and surfaces error to UI.
   - Acceptance: Auth failures and backend errors result in clear UI messages (no silent retries).

Secondary priorities (if time allows) 4. Implement E (In‑UI smoke test) — 1–2 hours

- Deliverable: Button that runs preview→export and reports pass/fail in the UI and stores a small diagnostic JSON on failure.

5. Prepare G (Playwright/Puppeteer e2e script) — 2–4 hours
   - Deliverable: A basic headless script that simulates the UI flow and saves a PDF artifact when successful.

Risks and mitigations

- Puppeteer not available in Codespace: fallback is to run a lighter smoke test that verifies headers and response status without rendering PDF; escalate to provide a Chromium-enabled image if needed.
- Network/tunnel pf-signin interruptions: make 5173 public once and rely on `DEV_AUTH_TOKEN` to protect endpoints.

Schedule & owners

- Sprint lead: (you) — final acceptance and demo. Confirm when ready to review.
- Implementation: I'll implement A–D today and notify when complete; if you prefer a different owner, note it here.

Communication

- Status updates pushed to this branch as incremental commits. File `docs/V0.1_objectives_and_plan.md` will record the day's progress and any blockers.

Ready-to-run checklist for review

- After implementation, perform these frontend-only checks in the browser:
  - Load the app (Vite URL) and click "Load V0.1 demo".
  - Click Export and ensure the PDF downloads and opens.
  - If Export fails, the UI shows a clear toast with the error and a downloadable diagnostic JSON.
